# Oracle E-Business Suite Maximum Availability Architecture Disaster Recovery Scripts

     Version 1.0

Copyright (c) 2025 Oracle and/or its affiliates.

Released under the Universal Permissive License v1.0 as shown at
<https://oss.oracle.com/licenses/upl/>.

The scripts provided here are a potential starting point for implementing full-stack automation of disaster recovery site switchover, failover, and middle tier file synchronization for Oracle E-Business Suite (EBS) R12.2 that have their database deployed on Oracle Exadata database machines in Oracle Cloud Infrastructure (OCI).  They are examples.  They are not part of any Oracle product, nor are they under any warranty.  They are intended for customers to learn from and perhaps modify for their deployment.

See the overall README for these scripts, in the parent directory, EBSR12.2onOCI.

## Overview

The automation scripts for the application tier start and stop EBS application services and manage replication of the application file systems for different scenarios – normal operations at the primary, switching the standby to primary, and using the standby for snapshot standby testing.

The scripts should be placed in a common location at each site, one that each application tier compute instance at that site can access.  As on the database servers, this directory is referenced as $SCRIPT_DIR.  We recommend - and assume - adding the script directory to the administrator account’s PATH.

As with the database scripts, these scripts are written in Korn shell (ksh), use common routines / standard functions, and spawn SQL*Plus in a coroutine if needed, so that only one database connection is started.


## Using the EBS MAA DR Scripts

Please refer to the following solution playbooks for details about the Oracle E-Business Suite (EBS) topology, setup, and how to use these scripts:

* [Learn about maximum availability architecture for Oracle E-Business Suite](https://docs.oracle.com/en/solutions/learn-about-maa-for-ebs/index.html)

* [Provision and deploy a Maximum Availability Architecture solution for Oracle E-Business Suite on Oracle Cloud Infrastructure](https://docs.oracle.com/en/solutions/deploy-maa-for-ebs-on-oci/index.html)

The scripts should be placed in a common location at each site - one that all application and middle tier compute instances can access.  In this project, we created the following directory location on each site’s shared file system, and labeled it $SCRIPT_DIR in our .env file:
/u02/app/ebs/custom_admin_scripts/VISPRD

ALWAYS test scripts thoroughly on a test environment before promoting them to a production environment.

> [!IMPORTANT] 
> Verify that you have completed all the prerequisites listed in the playbooks referenced above before testing these scripts.


## Scripts Managing the Application

The scripts for starting and stopping the application with awareness of switchover, failover, and operating as a snapshot standby for testing purposes  

=====================================

| Script | Content |
| ------ | ------ |
| ebsAppTier.env | Configuration details for middle tier scripts, so the scripts themselves are kept generic |
| web_entry_test.env | Parameters for web entry points when using standby for snapshot standby testing |
| web_entry_prod.env | Parameters for production web entry points, if they differ at the two sites |
| stdfuncs.sh | A set of standard functions – generic routines that are useful when scripting Linux, database, and EBS administrative tasks – to include in calling scripts on both the database and the application tier.  Using these common functions simplifies each working script, making the code easier to write and maintain. As this file is simply a set of common routines , it does not start with a shebang.  The calling script must have #!ksh as its first line for these routines to work properly.|
| startEBS.sh | This script combines the tasks needed to start EBS for three scenarios – normal operations, at the standby site for testing purposes, and as the final part of a switchover from the primary to the standby site for production operations. |
| stopEBS.sh | Stop EBS and middle tier services, either as a normal shutdown or as part of a switchover to a standby site |


## Scripts Managing File System Replication

Data Guard manages replication of data stored in the database from the primary site to the standby.  Certain file systems also need to be replicated – the application and middle tier software, and the file-based output generated by the application programs.  The software directories do not change frequently but do need to be kept in sync across the sites when the source is patched.  The file-based output holds batch processing logs, report output, and interface files that have been generated for other systems outside the EBS database.  These files need to be as close to in sync with the data inside the database as feasible, to ease the task of resolving differences between the state of data in the database and these flat files on failover.

The rsync script in this section replicates specific file system directories from the primary to the standby.  The core synchronization script addresses these basic requirements:
* Regularly synchronize the file systems holding the relatively unchanging application and middle tier software to the standby
* Aggressively synchronize the file systems holding runtime output, keeping them as up to date as possible at the standby
* Avoid replicating instance-specific configuration data
* Allow file system replication to continue while using the standby for snapshot standby testing
* Multi-thread the data transfers so that they complete in a reasonable amount of time

The rsync direction is managed through site role transitions.  The scripts are deployed at each region/site and are designed to always be running at each site as a cron job.  The script's behavior depends on whether the rsync process is enabled or disabled and whether the site's database is in the PRIMARY or STANDBY role.  These scripts respond to database role transitions and automatically change the direction of the replication.

We recommend the actual rsync script be run on a dedicated pair of compute instances, one at each site, so that snapshot standby testing at the DR site can take place without disrupting replication of production changes to the standby file system.

Example CRON job entries for the rsync scripts:  
SCRIPT_DIR=/u02/app/ebs/custom_admin_scripts/VISPRD  
*/5 * * * * applmgr $SCRIPT_DIR/syncEBS.sh $SCRIPT_DIR/fastFiles.env  
0 1 * * * applmgr $SCRIPT_DIR/syncEBS.sh $SCRIPT_DIR/slowFiles.env


Note: These scripts are built with the assumption that the EBS application tiers are deployed on shared file systems in OCI.  We used OCI’s File System Service (FSS).


=====================================

| File | Content |
| ------ | ------ |
| stdfuncs.sh | This is the same file as described above, in Managing the Application |
| ebsAppTier.env | This is the same file as described above, in Managing the Application |
| ebsRsync.env | Environment settings for rsync scripts.  They need database access and the ability to connect to the remote app tiers |
| slowFiles.env | Pointers to the files detailing directories to copy and files to exclude from those directories, and the files to copy in addition to those in the directories, for files and directories that DO NOT change frequently |
| fastFiles.env | Pointers to the files detailing directories to copy and files to exclude from those directories, and the files to copy in addition to those in the directories, for files and directories that DO change frequently |
| <static or dynamic>Directories.txt | Files holding one line per directory to be synchronized by either the "slow" (static) or "fast" (dynamic) synchronization runs |
| <static or dynamic>ExcludeFiles.txt | Files holding one line per file to be excluded from either the "slow" (static) or "fast" (dynamic) synchronization runs |
| <static or dynamic>IncludeFiles.txt | Files holding one line per file to be added to either the "slow" (static) or "fast" (dynamic) synchronization runs |
| enable_ebs_rsync.sh | Set this site up to be the source for file system replication, and enable the processes |
| disable_ebs_rsync.sh | Disable the rsync process at this site.  Must be done at the standby site. |
| syncEBS.sh | Multi-threaded file system synchronization driver. |
| killSsync.sh | Only used on switchover.  Kill any currently-running rsync process so a new one can be started, to efficiently ensure the standby file system is up to date prior to activating the standby site. |
